<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>首页</title>
<script type="text/javascript"
	th:src="@{/js/import/jquery-3.4.1.min.js}"></script>
<script type="text/javascript"
	th:src="@{/js/import/popper-1.14.7.min.js}"></script>
<script type="text/javascript"
	th:src="@{/js/import/bootstrap/bootstrap-3.3.2.min.js}"></script>
<script type="text/javascript"
	th:src="@{/js/import/bootstrap/bootstrap-multiselect-0.9.15.js}"></script>
<script type="text/javascript"
	th:src="@{/js/import/cytoscape.js-3.13.1/cytoscape.min.js}"></script>
<link rel="stylesheet"
	th:href="@{/css/import/bootstrap/bootstrap-3.3.2.min.css}"></link>
<link rel="stylesheet"
	th:href="@{/css/import/bootstrap/bootstrap-multiselect-0.9.15.css}"></link>
<style type="text/css">
.div_content {
	height: 600px;
	border: 1px solid #000;
	margin-bottom: 5px;
}
</style>
</head>
<body>
	<div class="container-lg col-sm-12", style="margin-top: 15px; margin-bottom: 15px;">
		<div th:if="${features}">
			<div>
				<hr />
				<h3>Features</h3>
			</div>
			<form role="form">
				<div class="form-group">
					<label for="features-select">选择Feature：</label> <select
						id="features-select" multiple="multiple">
						<option th:each="feature:${features}"
							th:value="${feature.featureId}" th:text="${feature.featureName}"></option>
					</select>
					<button type="button" id="featuresSelectedConfirm"
						class="btn btn-default">确定</button>
				</div>
			</form>
			<div id="catoscape">
			</div>
		</div>
	</div>
	<script type="text/javascript" th:inline="javascript">
//<![CDATA[
$(document).ready(function() {
	var features = [[${features}]];
	var microservices = [[${microservices}]];
    $('#features-select').multiselect({
    	includeSelectAllOption: true
    });
    $("#featuresSelectedConfirm").click(function(e){
    	var featureIds = $("#features-select").val();
    	var html = "";
    	for(var i = 0; i < featureIds.length; i++) {
    		html += "<div class='col-sm-10 div_content' id='div_content_" + i + "'></div>";
    	}
    	$("#catoscape").html(html);
    	for(var i = 0; i < featureIds.length; i++) {
    		showMicroService(featureIds[i], $("#div_content_" + i));
    	}
    });
    var showMicroService = function(featureId, container) {
	    $.getJSON("/feature/show/microservice/" + featureId + "?removeUnuseMicroService=true",
	    	function(result){
	    	console.log(result);
	    	if(result.result == "success") {
	    		var elements = result.value;
	    		showMicroServiceInCatoscape(elements, container);
	    	}
	    });
    }
    var html = "<div class='col-sm-10 div_content' id='div_content'></div>";
	$("#catoscape").html(html);
    showMicroService("all", $("#div_content"));
    var showMicroServiceInCatoscape = function(elements, container){
    	var cy = cytoscape({
        	container: container,
        	layout: {
        		name: "circle"
        	},
        	style: [
        		{
                    selector: 'node[name]',
                    style: {
                      'content': 'data(name)'
                    }
                },
        		{
        			selector: 'node',
        			style: {
        				'height': 20,
        				'width': 20,
        				'background-color': 'green'
        			}
        		},
        		{
        			selector: 'edge[value]',
        			style: {
        				'content': 'data(value)'
        			}
        		},
    			{
        			selector: 'edge',
        			style: {
        				'curve-style': 'bezier',
        				'width': 3,
        				'line-color': 'green',
                        'target-arrow-shape': 'triangle',
                        'target-arrow-color': 'green'
        			}
        		}
        	],
        	elements: elements
        });
    }
    
});
// ]]>
</script>
</body>
</html>